jQuery(document).ready((function(e){if(etsUltimateMemberParams.is_admin){function t(t,r){var m=r.draggable;e(this).append(m),e('*[data-drop-ultimate-member_role_id="'+m.data("ultimate-member_role_id")+'"]').droppable({drop:a,hoverClass:"hoverActive"}),e('*[data-drop-ultimate-member_role_id="'+m.data("ultimate-member_role_id")+'"]').attr("data-drop-ultimate-member_role_id","");var i=JSON.parse(localStorage.getItem("ultimatemember_mapArray"))||[];e.each(i,(function(e,t){if(t){var a=t.split(",");a[0]!="ultimate-member_level_id_"+m.data("ultimate-member_level_id")&&a[1]!=m.data("ultimate-member_role_id")||delete i[e]}}));var l="{";e.each(i,(function(e,t){if(t){var a=t.split(",");a[0]=="ultimate-member_level_id_"+m.data("ultimate-member_level_id")&&a[1]==m.data("ultimate-member_role_id")||(l=l+'"'+a[0]+'":"'+a[1]+'",')}})),localStorage.setItem("ultimatemember_mapArray",JSON.stringify(i)),","==l.slice(-1)&&(l=l.slice(0,-1));var o=l+"}";e("#ultimate-member_maaping_json_val").html(o),localStorage.setItem("ultimatemember_mappingjson",o),m.css({width:"100%",left:"0",top:"0","margin-bottom":"10px"})}function a(t,r){var m=r.draggable;if(e('*[data-drop-ultimate-member_role_id="'+m.data("ultimate-member_role_id")+'"]').droppable({drop:a,hoverClass:"hoverActive"}),e('*[data-drop-ultimate-member_role_id="'+m.data("ultimate-member_role_id")+'"]').attr("data-drop-ultimate-member_role_id",""),e(this).data("drop-ultimate-member_role_id")!=m.data("ultimate-member_role_id")){var i=JSON.parse(localStorage.getItem("ultimatemember_mapArray"))||[];e(this).attr("data-drop-ultimate-member_role_id",m.data("ultimate-member_role_id")),m.attr("data-ultimate-member_level_id",e(this).data("ultimate-member_level_id")),e.each(i,(function(t,a){if(a){var r=a.split(",");r[0]!="ultimate-member_level_id_"+e(this).data("ultimate-member_level_id")&&r[1]!=m.data("ultimate-member_role_id")||delete i[t]}}));var l="ultimate-member_level_id_"+e(this).data("ultimate-member_level_id");i.push(l+","+m.data("ultimate-member_role_id"));var o="{";e.each(i,(function(t,a){if(a){var r=a.split(",");(r[0]=="ultimate-member_level_id_"+e(this).data("ultimate-member_level_id")||r[1]!=m.data("ultimate-member_role_id")&&r[0]!="ultimate-member_level_id_"+e(this).data("ultimate-member_level_id")||r[1]==m.data("ultimate-member_role_id"))&&(o=o+'"'+r[0]+'":"'+r[1]+'",')}})),localStorage.setItem("ultimatemember_mapArray",JSON.stringify(i)),","==o.slice(-1)&&(o=o.slice(0,-1));var d=o+"}";localStorage.setItem("ultimatemember_mappingjson",d),e("#ultimate-member_maaping_json_val").html(d)}e(this).append(r.draggable),e(this).find("span").css({order:"2"}),jQuery(this).find(".makeMeDraggable").length>=1&&e(this).droppable("destroy"),m.css({width:"100%",left:"0",top:"0","margin-bottom":"0px",order:"1"})}e.ajax({type:"POST",dataType:"JSON",url:etsUltimateMemberParams.admin_ajax,data:{action:"ets_ultimatemember_discord_load_discord_roles",ets_ultimatemember_discord_nonce:etsUltimateMemberParams.ets_ultimatemember_discord_nonce},beforeSend:function(){e(".ultimate-member-discord-roles .spinner").addClass("is-active"),e(".initialtab.spinner").addClass("is-active")},success:function(t){if(null!=t&&t.hasOwnProperty("code")&&50001==t.code&&"Missing Access"==t.message)e(".ultimatemember-btn-connect-to-bot").show();else if(null==t||"401: Unauthorized"==t.message||t.hasOwnProperty("code")||0==t)e("#ultimatemember-connect-discord-bot").show().html("Error: Please check all details are correct").addClass("error-bk");else{e('.ets-tabs button[data-identity="level-mapping"]').length&&e('.ets-tabs button[data-identity="level-mapping"]').show(),e("#ultimatemember-connect-discord-bot").show().html("Bot Connected <i class='fab fa-discord'></i>").addClass("not-active");var a=localStorage.getItem("activeTab");0==e('.ets-tabs button[data-identity="level-mapping"]').length&&"level-mapping"==a&&e('.ets-tabs button[data-identity="settings"]').trigger("click"),e.each(t,(function(t,a){var r=!1;a.hasOwnProperty("tags")&&a.tags.hasOwnProperty("bot_id")&&(r=!0),"previous_mapping"!=t&&0==r&&"@everyone"!=a.name&&(e(".ultimate-member-discord-roles").append('<div class="makeMeDraggable" style="background-color:#'+a.color.toString(16)+'" data-ultimate-member_role_id="'+a.id+'" >'+a.name+"</div>"),e("#ultimate-member-defaultRole").append('<option value="'+a.id+'" >'+a.name+"</option>"),e(".makeMeDraggable").draggable({revert:"invalid"}))}));var r=e("#selected_default_role").val();if(r&&e("#ultimate-member-defaultRole option[value="+r+"]").prop("selected",!0),t.previous_mapping)var m=t.previous_mapping;else m=localStorage.getItem("ultimatemember_mappingjson");e("#ultimate-member_maaping_json_val").html(m),e.each(JSON.parse(m),(function(t,a){var r=t.split("id_");e('*[data-ultimate-member_level_id="'+r[1]+'"]').append(e('*[data-ultimate-member_role_id="'+a+'"]')).attr("data-drop-ultimate-member_role_id",a).find("span").css({order:"2"}),jQuery('*[data-ultimate-member_level_id="'+r[1]+'"]').find(".makeMeDraggable").length>=1&&e('*[data-ultimate-member_level_id="'+r[1]+'"]').droppable("destroy"),e('*[data-ultimate-member_role_id="'+a+'"]').css({width:"100%",left:"0",top:"0","margin-bottom":"0px",order:"1"}).attr("data-ultimate-member_level_id",r[1])}))}},error:function(t){e("#ultimatemember-connect-discord-bot").show().html("Error: Please check all details are correct").addClass("error-bk"),console.error(t)},complete:function(){e(".ultimate-member-discord-roles .spinner").removeClass("is-active").css({float:"right"}),e("#skeletabsTab1 .spinner").removeClass("is-active").css({float:"right",display:"none"})}}),e("#revertMapping").on("click",(function(){localStorage.removeItem("ultimatemember_mapArray"),localStorage.removeItem("ultimatemember_mappingjson"),window.location.href=window.location.href})),e((function(){e(".makeMeDroppable").droppable({drop:a,hoverClass:"hoverActive"}),e(".ultimate-discord-roles-col").droppable({drop:t,hoverClass:"hoverActive"})}))}})),etsUltimateMemberParams.is_admin&&jQuery.skeletabs.setDefaults({keyboard:!1});